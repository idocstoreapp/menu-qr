---
import AdminLayout from '../../layouts/AdminLayout.astro';
import CategoryManager from '../../components/admin/CategoryManager';
import MenuItemManagerV2 from '../../components/admin/MenuItemManagerV2';
import { getAuthUser } from '../../lib/api-helpers';

// Verificar autenticaciÃ³n
const user = getAuthUser(Astro);
if (!user) {
  return Astro.redirect('/admin/login');
}

// Obtener tab activo de la URL
const activeTab = Astro.url.searchParams.get('tab') || 'items';
---

<AdminLayout title="Panel de AdministraciÃ³n - Gourmet Ãrabe">
  <div class="min-h-screen p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
      <!-- Header -->
      <header class="mb-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
          <div>
            <h1 class="text-2xl md:text-4xl font-cinzel text-gold-400">Panel de AdministraciÃ³n</h1>
            <p class="text-gold-300/70 mt-1">Gestiona tu menÃº digital</p>
          </div>
          <div class="flex flex-wrap gap-3">
            <a 
              href="/" 
              target="_blank"
              class="bg-arabic-brown text-gold-400 px-4 py-2 rounded-lg hover:bg-terracotta-600 transition flex items-center gap-2 text-sm"
            >
              ğŸ‘ï¸ Ver MenÃº
            </a>
            <a 
              href="/print" 
              target="_blank"
              class="bg-arabic-brown text-gold-400 px-4 py-2 rounded-lg hover:bg-terracotta-600 transition flex items-center gap-2 text-sm"
            >
              ğŸ–¨ï¸ Imprimir
            </a>
            <form method="POST" action="/api/logout">
              <button type="submit" class="bg-red-600 text-cream px-4 py-2 rounded-lg hover:bg-red-500 transition text-sm">
                ğŸšª Salir
              </button>
            </form>
          </div>
        </div>

        <!-- Tabs de navegaciÃ³n -->
        <nav class="flex gap-2 border-b-2 border-gold-600/30 pb-0">
          <a 
            href="/admin?tab=items"
            class={`px-6 py-3 rounded-t-lg transition font-medium ${
              activeTab === 'items' 
                ? 'bg-gold-600 text-arabic-dark' 
                : 'bg-arabic-brown text-gold-400 hover:bg-terracotta-600'
            }`}
          >
            ğŸ½ï¸ Items del MenÃº
          </a>
          <a 
            href="/admin?tab=categories"
            class={`px-6 py-3 rounded-t-lg transition font-medium ${
              activeTab === 'categories' 
                ? 'bg-gold-600 text-arabic-dark' 
                : 'bg-arabic-brown text-gold-400 hover:bg-terracotta-600'
            }`}
          >
            ğŸ“ CategorÃ­as
          </a>
        </nav>
      </header>

      <!-- Contenido segÃºn tab activo -->
      <div class="bg-arabic-dark p-4 md:p-6 rounded-lg border-2 border-gold-600">
        {activeTab === 'items' && (
          <MenuItemManagerV2 client:load />
        )}
        {activeTab === 'categories' && (
          <CategoryManager client:load />
        )}
      </div>

      <!-- InformaciÃ³n adicional -->
      <div class="mt-8 bg-arabic-brown/50 border border-gold-600/30 rounded-lg p-4">
        <h3 class="text-gold-400 font-semibold mb-2">ğŸ’¡ Consejos</h3>
        <ul class="text-gold-300/80 text-sm space-y-1">
          <li>â€¢ <strong>Agregar producto:</strong> Clic en "Nuevo Item" â†’ Llena el formulario con nombre, precio, descripciÃ³n e imagen</li>
          <li>â€¢ <strong>Editar producto:</strong> Clic en "âœï¸ Editar" en cualquier item</li>
          <li>â€¢ <strong>Ocultar temporalmente:</strong> Usa el botÃ³n "Disponible/No disp." para items agotados</li>
          <li>â€¢ <strong>Subir imagen:</strong> En el formulario de ediciÃ³n, selecciona una imagen (mÃ¡x 5MB)</li>
          <li>â€¢ <strong>Reordenar:</strong> Cambia el nÃºmero de "Orden" para controlar la posiciÃ³n</li>
          <li>â€¢ Los cambios se reflejan inmediatamente en el menÃº pÃºblico y la versiÃ³n imprimible</li>
        </ul>
      </div>
    </div>
  </div>
</AdminLayout>
